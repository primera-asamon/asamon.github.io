<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
       table {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
        }
        .child-table {
            border-collapse: collapse;
            background-color: #ffffff;
            font-size:xx-small;
        }
        tr.record-table{
            background-color: #ffffff;
            border-color:#ffffff
        }
        th {
            background-color: #f2f2f2;
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
            font-size: small;
            font-weight: normal;
        }
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
            font-size: small;
            font-weight: normal;
        }
        .row-header {
            background-color: #f2f2f2;
            font-weight:normal;
            font-size:smaller;
            min-width:30px;
        }
        .row-header_skillname {
            background-color: #f2f2f2;
            font-weight:normal;
            font-size:smaller;
            width: calc(100% - 5 * 100px);
            min-width:60px;
        }
        .row-data {
            background-color: #ffffff;
            min-width:60px;
        }
        .col-header {
            background-color: #f2f2f2;
            width:80px;
            font-weight:normal;
            font-size:smaller;
        }
        .col-data {
            background-color: #ffffff;
            min-width:80px;
        }
        .col-data_no {
            background-color: #edf;
            width:60px;
            border-right-color: #edf;
            font-size: small;
        }
        .col-data_level {
            background-color: #edf;
            width: 60px;
            border-left-color: #edf;
            border-right-color: #edf;
            font-size: medium;
        }
        .col-data_skillname {
            background-color: #edf;
            width: calc(100% - 5 * 100px);
            min-width:300px;
            border-left-color: #edf;
            font-size: medium;
        }
    .footer-text {
        margin-bottom: 6px;
        color: #999;
        font-size: 0.8em;
    }

    .footer-copyright {
        color: #000;
        font-size: 0.8em;
    }
/* スマホ用メディアクエリ対応 2025-06-22-16:40 */
    @media (max-width: 600px) {
        .record-table > td {
        padding: 0;
    }
    .record-table table,
    .record-table tr,
    .record-table td,
    .record-table th {
        display: block;
        width: 100%;
    }
    .record-table {
        margin-bottom: 1.5em;
        border-radius: 8px;
        box-shadow: 0 2px 6px #eee;
        overflow: hidden;
    }
    .col-data_skillname {
        font-size: 1.1em;
        font-weight: bold;
        background: #eaf6ff;
        margin-bottom: 6px;
    }
}
    </style>
    <title>技術・魔法一覧</title>
</head>
<body>
<!-- ページ冒頭に非表示で読み上げ対応の国際化・説明テキスト -->
    <p id="screenreader-info" lang="en">
        This page lists MMORPG skills for Japanese-speaking players. It does not contain navigation or language switching. If you are using a screen reader or are not fluent in Japanese, please note that this page is for reference only and may not offer interactive support.
    </p>
<!-- 日本語でのページ説明（視認表示可） -->
    <p id="screenreader-info_jp" class="page-description">
        このページは日本語話者向けに設計されたMMORPGスキルの一覧表です。リンクやナビゲーション機能は設けておらず、ページ全体の内容を1ページで完結する構成になっています。内容の把握を主目的としています。
    </p>
<!-- 技術・魔法一覧のインポート(旧仕様)※スマホでは取得できないから 
 <input type="file" id="fileInput">
-->
<!-- 技術・魔法一覧のインポート(前仕様)※ファイル全体のペースト(長大なデータでは不適当) -->
<!-- <button id="submitBtn">表示</button>
     <div id="output"></div>
-->
<!-- 技術・魔法一覧のインポート(新仕様)※ファイル名のハードコーディング -->
    <button id="loadBtn">表示</button>
    <button id="saveBtn">保存</button>
    <!-- 技術・魔法一覧表の表示エリア -->
    <div id="result"></div>
    <div class="footer-text">
        <footer role="contentinfo">
            <section lang="ja">
                <small>当サイトで使用されているリネージュの画像・BGM及びその他の表現物の権利は下記のとおり権利者に帰属します：</small>
            </section>
            <section lang="en">
                <small>Lineage and Lineage Eternal Life are registered trademarks of NCsoft Corporation.&copy;  1998-2011 Copyright NCsoft Corporation. NC Japan K.K. was granted by NCsoft Corporation the right to publish, distribute, and transmit Lineage Eternal Life in Japan. All Rights Reserved.</small>
            </section>
            <section lang="zh-TW">
                <small>本頁面使用之《Lineage》相關素材，其版權皆屬原創作者所有。</small>
            </section>
        </footer>
    </div>
<script>
// document.getElementById('fileInput').addEventListener('change', function(e) {
    document.getElementById('loadBtn').addEventListener('click', function() {
  // 英文説明/日本語説明をスクリーンリーダー向けの非表示スタイルを付加
    const info_en = document.getElementById("screenreader-info");
    const info_jp = document.getElementById("screenreader-info_jp");
  // 非表示クラスを付加（すでに付いていなければ）
    if (!info_en.classList.contains("sr-only")) {
        info_en.classList.add("sr-only");
    }
    if (!info_jp.classList.contains("sr-only")) {
        info_jp.classList.add("sr-only");
    }
  // TSV読み込みと描画
    fetch('LineageREMASTER_skill3.txt?v=' + new Date().getTime())
// fetch('LineageREMASTER_skill3.txt')
        .then(response => response.text())
        .then(text => {
// 必要ならここでparseTSV(text)などの処理を呼び出す
// document.getElementById('submitBtn').addEventListener('click', function() {
//     const text = document.getElementById('textInput').value;
//     parseTSV(text);
// });
// function parseTSV(text) {
// ここにTSVパース＆表示処理を書く
//    const reader = new FileReader();
//     reader.onload = function() {
        const lines = text.trim().split('\n');
        let html = `<table>`;
        for (const line of lines) {
            const fields = line.split('\t');
            console.log(`フィールド数(${line}):`, fields.length); // フィールド数を確認

            if (fields.length < 24) {
                console.warn("データ不足:", fields);
                continue; // フィールド数が不足している場合スキップ
            }
            const [no,img,level,name,cls,elf,active,type,align,mp,hp,material,duration,target,reuse,effect,acqLv,obtain,price,Droporigin,Dropcomp,note1,note2,EOR] = line.split('\t');
            // 各フィールドをTAB分割 EOR(End Of Record)を無視
            // imgは画像のURLだが、ここでは使用しないので無視。値は"全角Space"
            // EORは行の終わりを示すが、ここでは使用しないので無視。値は"■"
            // clsとelfのまとめ表示
            let clsDisplay = cls;
            if (cls === "妖" && elf) {
                clsDisplay += `（${elf}）`;
            }
        html += `<tr class="record-table">
                <td colspan="11">
                    <table>`
            // No.とLevelとスキル名は「<th>～」を使用しない。
                html += `<tr>
                            <td class="col-data_no">No.${no}</td>`
                // ...existing code...
                // 等級・スキルレベルの出力部分
                            if (/^\d+$/.test(level)) {
                    // 数字のみの場合
                                html += `<td class="col-data_level contenteditable="true"">Lv.${level}</td>`;
                            } else {
                    // 空または文字列（神話・伝説など）の場合
                                html += `<td class="col-data_level contenteditable="true"">${level}</td>`;
                            }   
                // ...existing code...                        
                //            <th class="col-header" colspan="2">等級・スキルレベル</th><td class="col-data">${level}</td>
                    html += `<td class="col-data_skillname" contenteditable="true" colspan="9">${name}</td>`
                html += `</tr>`
                html += `<tr>`
                    html += `
                            <th class="col-header">習得クラス</th>
                            <td class="col-data" contenteditable="true" colspan="2">${clsDisplay}</td>
                            <th class="col-header">活性</th><td class="col-data" contenteditable="true">${active}</td>
                            <th class="col-header">種類</th><td class="col-data" contenteditable="true">${type}</td>
                            <th class="col-header">性向</th><td class="col-data" contenteditable="true">${align}</td>
                        </tr>
                        <tr>
                            <th class="col-header">消耗MP</th><td class="col-data" contenteditable="true">${mp}</td>
                            <th class="col-header">消耗HP</th><td class="col-data" contenteditable="true">${hp}</td>
                            <th class="col-header">材料・触媒</th><td class="col-data" contenteditable="true" colspan="3">${material}</td>
                            <th class="col-header">持続時間</th><td class="col-data" contenteditable="true" colspan="3">${duration}</td>
                        </tr>
                        <tr>
                            <th class="col-header">対象</th><td class="col-data" contenteditable="true" colspan="2">${target}</td>
                            <th class="col-header">再使用時間</th><td class="col-data" contenteditable="true">${reuse}</td>
                            <th class="col-header">効果・性能</th><td class="col-data" contenteditable="true" colspan="7">${effect}</td>
                        </tr>
                        <tr>
                            <th class="col-header">習得Lv.</th><td class="col-data" contenteditable="true">${acqLv}</td>
                            <th class="col-header">取得方法</th><td class="col-data" contenteditable="true" colspan="3">${obtain}</td>
                            <th class="col-header">価格</th><td class="col-data" contenteditable="true" colspan="5">${price}</td>
                        </tr>
                        <tr>
                            <th class="col-header">ドロップ</th><td class="col-data" contenteditable="true" colspan="10">${Droporigin}</td>
                        </tr>
                        <tr>
                            <th class="col-header">【蘇生】</th><td class="col-data" contenteditable="true" colspan="10">${Dropcomp}</td>
                        </tr>
                        <tr>
                            <th class="col-header">備考1</th><td class="col-data" contenteditable="true" colspan="5">${note1}</td>
                            <th class="col-header">備考2</th><td class="col-data" contenteditable="true" colspan="4">${note2}</td>
                        </tr>
                    </table>
                </td>
            </tr>`;
        }
        html += `</table>`;
        document.getElementById('result').innerHTML = html;
// 保存ボタンのイベント
    document.getElementById('saveBtn').addEventListener('click', function() {
        let tsv = '';
        // 各レコードテーブルを取得
        document.querySelectorAll('.record-table table').forEach(table => {
            let rowData = [];
            // 編集可能なセルだけ取得
            table.querySelectorAll('td[contenteditable="true"]').forEach(td => {
                // 先頭の "Lv." などを除去したい場合は下記のように調整
                let text = td.textContent.replace(/^Lv\./, '').trim();
                rowData.push(text);
            });
            // 1レコード分をタブ区切りで連結
            tsv += rowData.join('\t') + '\n';
        });

        // ダウンロード用リンクを生成
        const blob = new Blob([tsv], {type: 'text/tab-separated-values'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'LineageREMASTER_skill_edited.tsv';
        a.click();
        URL.revokeObjectURL(url);
    });
// reader.readAsText(e.target.files[0], 'UTF-8');
    console.log(text); // デバッグ用
        })
        .catch(error => {
            document.getElementById('result').textContent = '読み込み失敗: ' + error;
        });
    // ここでaddEventListenerの関数を閉じる
});
</script>
</body>
</html>